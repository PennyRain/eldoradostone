!function(){"use strict";var e={40602:function(e,t,o){var n=o(9571),r=o(63556);t.Z=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const s=(0,n.Z)().toString();return(0,r.U)()?new Promise(((e,o)=>{const n=t=>{try{if(t.data){const{data:r}=t,{payload:a}=r;if("PROXY_FETCH_RESPONSE"===r.EVENT_NAME&&a.token===s){if(a.fetchResponseBlob){const t=new Response(a.fetchResponseBlob.stream(),a.fetchResponseProps);e(t)}else a.fetchError?o(a.fetchError):o("Need to handle this");window.removeEventListener("message",n)}}}catch(e){console.log(e)}};window.addEventListener("message",n),(0,r.Z)({EVENT_NAME:"PROXY_FETCH",payload:{fetch:t,token:s}},"*")})):window.fetch(...t)}},63556:function(e,t,o){o.d(t,{U:function(){return n}});const n=()=>!!window.BUGHERD_REACT_APP_SIDEBAR_MOUNT&&(window.BUGHERD_REACT_APP_SIDEBAR_MOUNT.getRootNode().querySelector("#bugherdCommunicator")||window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId);t.Z=function(){if(window.BUGHERD_REACT_APP_SIDEBAR_MOUNT){const e=window.BUGHERD_REACT_APP_SIDEBAR_MOUNT.getRootNode().querySelector("#bugherdCommunicator");if(e)return void e.contentWindow.postMessage(...arguments)}window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId?window.postMessage(...arguments):console.error("Couldn't find bugherdCommunicator iframe or window.BUGHERD_EXTENSION_CONFIG.extensionId to use for postMessage")}},9571:function(e,t,o){var n;o.d(t,{Z:function(){return u}});var r=new Uint8Array(16);function s(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}for(var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,i=function(e){return"string"==typeof e&&a.test(e)},d=[],c=0;c<256;++c)d.push((c+256).toString(16).substr(1));var u=function(e,t,o){var n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){o=o||0;for(var r=0;r<16;++r)t[o+r]=n[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!i(o))throw TypeError("Stringified UUID is invalid");return o}(n)}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){const e=(e,t,o)=>{o&&e.setAttribute(`data-${t}`,o)};var t=console.log;const n={default:{width:300,height:80,right:0},warning:{width:330,height:144,right:0}},r=()=>document.getElementById("bugherd_embed_communication_frame");let s=null;const a=(e,t)=>{t&&(s=t);const o=r(),{width:a,height:i,right:d}=n[e];o.style.width=`${a}px`,o.style.height=`${i}px`,o.style.top=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:70;return e?`calc((100% - ${t+10}px) * ${e/100})`:"0px"}(t||s,i),o.style.right=`${d}px`},i=e=>{e||(r().style.display="block")},d=()=>{t("[AUTH] Destroying auth iframe"),window.removeEventListener("bugherd_loaded",d),r().remove(),window._bugHerd_sidebar2021=void 0},c="hasStorageAccess"in document&&"requestStorageAccess"in document,u=()=>document.getElementById("bugherd_toggle"),l=e=>{u().onclick=e},p=e=>{e&&e.custom_logo_dark_background&&(document.getElementById("logo").src=e.custom_logo_dark_background)};var g=o(40602).Z,_=o(9571);const m=e=>{let{projectId:t,preferences:o}=e;try{const e={...JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`)),...o};window.localStorage.setItem(`sidebar_project_${t}`,JSON.stringify(e))}catch(e){console.log("Couldnt save user preferences to local storage",e)}};var E,w,h,S,b,y;function v(t){var o=document.createEvent("CustomEvent");if(o.initCustomEvent("bugherdSidebarParsed",!0,!0,JSON.stringify({status:"success",apiKey:t.apiKey})),document.dispatchEvent(o),"loading"===document.readyState)return void document.addEventListener("readystatechange",(e=>{"interactive"===e.target.readyState&&v(t)}));const{resources:n,apiKey:r,origin:s,embeddedByOldExtension:a}=t,{project:i}=n,d=["app-images","app-css","app-vendor",i.is_public&&!i.authenticated?"public":"app"];(t=>{let{apiKey:o,origin:n,project:r,bugsnagSidebarNewKey:s,embeddedByOldExtension:a,files:i}=t;const d=document.createElement("bugherd-sidebar");d.style.position="static",e(d,"projectid",r.id.toString()),e(d,"project",JSON.stringify(r)),e(d,"bugsnagsidebarnewkey",s),e(d,"embeddedByOldExtension",a.toString()),d.addEventListener("keydown",(e=>{e.stopPropagation()})),d.addEventListener("focusin",(e=>{e.stopPropagation()}));const c=d.attachShadow({mode:"open"});c.innerHTML='<div id="sidebar-root"></div>',window.BUGHERD_REACT_APP_SIDEBAR_MOUNT=c.getElementById("sidebar-root"),window.BUGHERD_API_KEY=o,(e=>{let{origin:t,files:o}=e;o.forEach((e=>{const o=document.createElement("script");o.src=`${t.replace("www.","sidebar.")}/clients/sidebar/${e}.1680679447696.js`,window.document.head.appendChild(o)}))})({origin:n,files:i}),document.body.appendChild(d)})({apiKey:r,origin:s,project:i,bugsnagSidebarNewKey:n.config.bugsnag_sidebar_new_key,embeddedByOldExtension:a,files:d})}let A=(e=>{let{embedUrl:t}=e;try{const e=new URL(t).search.replace(/^\?/,"").split("&").map((e=>e.split("="))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{apikey:""});return e&&e.apikey?e.apikey:null}catch{return null}})({embedUrl:(null===(E=document)||void 0===E||null===(w=E.currentScript)||void 0===w?void 0:w.src)||window.embedUrl});null!==(h=window.BUGHERD_EXTENSION_CONFIG)&&void 0!==h&&h.apiKey&&(A=window.BUGHERD_EXTENSION_CONFIG.apiKey);let f=(null===(S=window.BUGHERD_EXTENSION_CONFIG)||void 0===S?void 0:S.domain)||"https://localhost:3000",C="";if(null!==(b=document)&&void 0!==b&&null!==(y=b.currentScript)&&void 0!==y&&y.src){var N,T;const e=new URL(null===(N=document)||void 0===N||null===(T=N.currentScript)||void 0===T?void 0:T.src);f=e.origin,C=e.search}const O=f.replace("www.","sidebar.");if("/sidebar/embed_html"===window.document.location.pathname)(e=>{let{sidebarOrigin:o,apiKey:n}=e;u();const r=(0,_.Z)();let s=!1;window.addEventListener("message",(e=>{if("COOKIE_CHECK"===e.data.eventName)t("[AUTH] Check cookies"),((e,o)=>new Promise(((n,r)=>{g(`${e}/sidebar/resources?apikey=${o}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>e.project.is_active?e.project.authenticated?(t("[AUTH] _bugherd_session5 cookie valid"),n(e)):(document.cookie.includes("_bugherd_session5")?t("[AUTH] _bugherd_session5 cookie invalid"):t("[AUTH] _bugherd_session5 cookie does not exist"),r(e)):(t("[AUTH] Bugherd project disabled"),n(e)))).catch((e=>(t("[AUTH] _bugherd_session5 ping error"),r())))})))(o,n).then((o=>{const{project:n}=o;if(t("[AUTH] Authenticated"),n.active_task_id&&m({projectId:n.id,preferences:{route:`/sidebar/tasks/${n.active_task_id}`}}),!n.is_active)return e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:o}},e.origin);n.has_access?u().className="loading":u().className="noAccess",p(n);const a=(e=>{let{projectId:t,preference:o}=e;try{const e=JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`));if(!e)return;return e[o]}catch(e){console.log("Couldnt get user preferences from local storage",e)}})({projectId:n.id,preference:"route"});let i=e.data.manuallyAuthenticated;window.sessionStorage.getItem("bugherdSidebarManuallyAuthenticated")&&(i=!0,window.sessionStorage.removeItem("bugherdSidebarManuallyAuthenticated")),a&&"/toggle"!==a||!i||m({projectId:n.id,preferences:{route:"/sidebar"}}),(i||s)&&m({projectId:n.id,preferences:{anonymousUserId:r,route:"/sidebar"}}),e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!0,resources:o}},e.origin)})).catch((o=>{const{project:n}=o;t("[AUTH] Unauthenticated"),p(n),e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:o}},e.origin)}));else if("AUTH_HAS_STORAGE_ACCESS"===e.data.eventName){t("[AUTH] AUTH_HAS_STORAGE_ACCESS");const o=t=>{e.source.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS_RESPONSE",payload:{success:t}},e.origin)};if(!c)return o(null);document.hasStorageAccess().then((e=>{o(!!e)})).catch((e=>{o(!1)}))}else if("AUTH_REQUEST_STORAGE_ACCESS"===e.data.eventName){let o;t("[AUTH] AUTH_REQUEST_STORAGE_ACCESS");const n=t=>{t||(u().className="error");const n=(new Date).getTime()-o<=250;e.source.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE",payload:{success:t,isAutoDenied:n,anonymousUserId:r}},e.origin)};l((()=>{var e;o=(new Date).getTime(),e=n,document.requestStorageAccess().then((()=>{e(!0)}),(()=>{e(!1)})),s=!0}))}else"SHOW_UNAUTHENTICATED_UI"===e.data.eventName&&(u().className="",l((()=>{e.source.postMessage({eventName:"AUTH_REDIRECT_TO_LOGIN",payload:{anonymousUserId:r}},e.origin)})))}),!1)})({sidebarOrigin:O,apiKey:A});else{var U,H;const e=document.getElementsByTagName("bugherd-sidebar")[0],o=document.querySelector('script[src*="sidebarv2"]')&&!(null!==(U=document.currentScript)&&void 0!==U&&U.getAttribute("src").includes("sidebarv2")),n=document.querySelector('script[src*="sidebarv2"]')&&(null===(H=document.currentScript)||void 0===H?void 0:H.getAttribute("src").includes("source=extension"));if(e){const t=e.getAttribute("data-projectid");console.warn(`Bugherd: Wanted to embed project with apiKey ${A} but project with id ${t} was already embedded.`)}else if(o)console.warn("Bugherd: Wanted to embed project via new embed code (embed.js) but looks like old embed code exists (sidebarv2.js).");else if(window._bugHerd_sidebar2021)console.warn("Bugherd: Wanted to embed new sidebar but _bugHerd_sidebar2021 was already set");else{if(window._bugHerd_sidebar2021=!0,!A)throw new Error("Bugherd: sidebar is missing apiKey");(e=>{let{origin:o,search:n}=e;return new Promise(((e,r)=>{const s=(e=>{let{origin:t,search:o}=e,n="allow-scripts allow-popups allow-same-origin allow-popups-to-escape-sandbox";"requestStorageAccess"in document&&(n+=" allow-storage-access-by-user-activation");const r=document.createElement("iframe");return r.id="bugherd_embed_communication_frame",r.name="embedCommunication",r.sandbox=n,r.style.display="none",r.style.border="none",r.style.position="fixed",r.style.zIndex="2147483647",r.src=`${t}/sidebar/embed_html${o}`,document.body.appendChild(r),r})({origin:o,search:n}),c={hasStorageAccess:void 0,project:null,resources:null};window.addEventListener("bugherd_loaded",d);const u=()=>{a("default",c.project.toggle_vertical_position),i(c.project.has_sidebar_experiment_enabled),e({authenticated:!0,resources:c.resources})},l=()=>{e({resources:c.resources})};s.onload=()=>{window.addEventListener("message",(e=>((e,o,n)=>{var r,s;let{onSuccess:c,onShowPublicFeedback:u,reject:l,iframe:p,origin:g}=o;const _=`${g.replace("sidebar.","www.")}/users/sign_in?source=sidebar&utm_campaign=sidebar&redirect_to=${window.location.href}&anonymous_user_id=${null===(r=e.data)||void 0===r||null===(s=r.payload)||void 0===s?void 0:s.anonymousUserId}`;if("COOKIE_CHECK_RESPONSE"===e.data.eventName){var m;n.project=e.data.payload.resources.project,n.resources=e.data.payload.resources;const o=null===(m=n.project)||void 0===m?void 0:m.has_sidebar_experiment_enabled;n.project.is_active?null===n.project.id?(t("[BUGHERD] There is no project associated with this API Key"),l(),d()):!1===n.hasStorageAccess?(a("default",n.project.toggle_vertical_position),i(o),p.contentWindow.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS",payload:{origin:g}},g)):e.data.payload.success&&!n.project.has_access?(a("warning",n.project.toggle_vertical_position),i(o)):e.data.payload.success?c():n.project.is_public?u():null!==n.hasStorageAccess||n.project.always_show_widget?(p.contentWindow.postMessage({eventName:"SHOW_UNAUTHENTICATED_UI",payload:{origin:g,projectOrigin:window.location.origin}},g),a("warning",n.project.toggle_vertical_position),i(o)):(l(),d()):(t(`[BUGHERD] Project (${n.project.id}) is disabled`),l(),d())}else"AUTH_HAS_STORAGE_ACCESS_RESPONSE"===e.data.eventName?(n.hasStorageAccess=e.data.payload.success,null===e.data.payload.success?(t("[AUTH] hasStorageAccess: no api"),p.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:g}},g)):e.data.payload.success?(t("[AUTH] hasStorageAccess: true"),p.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:g}},g)):(t("[AUTH] hasStorageAccess: false"),p.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:g}},g))):"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE"===e.data.eventName?e.data.payload.success?(n.hasStorageAccess=!0,t("[AUTH] requestStorageAccess: true"),a("default"),p.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:g,manuallyAuthenticated:!0}},g)):(t("[AUTH] requestStorageAccess: false"),a("warning"),e.data.payload.isAutoDenied&&(window.location.href=_)):"AUTH_REDIRECT_TO_LOGIN"===e.data.eventName&&(window.location.href=_)})(e,{onSuccess:u,onShowPublicFeedback:l,reject:r,iframe:s,origin:o},c)),!1),s.contentWindow.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS",payload:{origin:o}},o)}}))})({origin:O,search:C}).then((e=>{let{resources:t}=e;v({apiKey:A,origin:f,resources:t,embeddedByOldExtension:n})})).catch((e=>{e&&console.error("[AUTH] Unauthenticated",e)}))}}}()}();
//# sourceMappingURL=embed.1680679447696.js.map;
